<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Âä®ÊÄÅÊü±Áä∂Âõæ - ÁªàÊûÅÊòüÁ≥ªÁâà</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #000000;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.5); border-radius: 10px; }
        
        #loading-screen {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #6366f1; font-weight: bold; letter-spacing: 0.2em;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        
        input[type="range"] { accent-color: #6366f1; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "react/jsx-runtime": "https://esm.sh/react@18.2.0/jsx-runtime",
        "three": "https://esm.sh/three@0.160.0",
        "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.15.16?external=react,react-dom,three",
        "@react-three/drei": "https://esm.sh/@react-three/drei@9.99.0?external=react,react-dom,three,@react-three/fiber",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0?external=react"
      }
    }
    </script>
</head>
<body>
    <div id="loading-screen">
        <div>SYSTEM INITIALIZING...</div>
    </div>
    
    <div id="root"></div>

    <script type="module">
        import React, { useRef, useMemo, useState, useEffect, Suspense } from 'react';
        import ReactDOM from 'react-dom/client';
        import { Canvas, useThree, useFrame } from '@react-three/fiber';
        import { 
          OrbitControls, 
          PerspectiveCamera, 
          Environment, 
          PerformanceMonitor,
          AdaptiveDpr,
          AdaptiveEvents,
          Text,
          Billboard,
          ContactShadows,
          Float,
          BakeShadows,
          Stars,
          Sparkles,
          Line
        } from '@react-three/drei';
        import * as THREE from 'three';
        import { 
          Play, Pause, RotateCcw, Monitor, Camera, MousePointer2, Settings2, X, Activity, MoveUp, TrendingUp, BarChart3
        } from 'lucide-react';

        setTimeout(() => {
            const ls = document.getElementById('loading-screen');
            if (ls) {
                ls.style.opacity = '0';
                setTimeout(() => ls.remove(), 500);
            }
        }, 1500);

        // ==========================================
        // 1. ÂÖ®Â±ÄÈÖçÁΩÆ
        // ==========================================
        const CONFIG = {
          "ui": {
            "title": "2024 ‰∫öÊ¥≤ GDP ÊéíÂêçÈ¢ÑÊµã",
            "unit": "‰∫øÁæéÂÖÉ",
            "subTitle": "Êï∞ÊçÆÊù•Ê∫êÔºöÂõΩÈôÖË¥ßÂ∏ÅÊîøÂ∫úÁªÑÁªá (IMF) ÁªüËÆ°Êä•Âëä",
            "meta": "ÊòüÁ≥ªÊü±Áä∂Ë∂ãÂäøÁ≥ªÁªü // PRO", 
            "axisX": "ÂõΩÂÆ∂ / Âú∞Âå∫",
            "axisY": "GDP ÊÄªÂÄº"
          },
          "data": [
            { "id": "1", "name": "‰∏≠ÂõΩ", "value": 18744, "color": "#ff3e3e", "flag": "üá®üá≥" },
            { "id": "2", "name": "Êó•Êú¨", "value": 4026, "color": "#ff5e5e", "flag": "üáØüáµ" },
            { "id": "3", "name": "Âç∞Â∫¶", "value": 3913, "color": "#ff9f43", "flag": "üáÆüá≥" },
            { "id": "4", "name": "Èü©ÂõΩ", "value": 1713, "color": "#feca57", "flag": "üá∞üá∑" },
            { "id": "5", "name": "Âç∞Â∫¶Â∞ºË•ø‰∫ö", "value": 1396, "color": "#ffdd59", "flag": "üáÆüá©" },
            { "id": "6", "name": "Ê≤ôÁâπÈòøÊãâ‰ºØ", "value": 1238, "color": "#48c48f", "flag": "üá∏üá¶" },
            { "id": "7", "name": "Êñ∞Âä†Âù°", "value": 547, "color": "#1dd1a1", "flag": "üá∏üá¨" },
            { "id": "8", "name": "‰ª•Ëâ≤Âàó", "value": 540, "color": "#00d2d3", "flag": "üáÆüá±" },
            { "id": "9", "name": "ÈòøËÅîÈÖã", "value": 537, "color": "#54a0ff", "flag": "üá¶üá™" },
            { "id": "10", "name": "Ê≥∞ÂõΩ", "value": 526, "color": "#5f27cd", "flag": "üáπüá≠" }
          ].sort((a, b) => a.value - b.value) 
        };

        const SCALE_FACTOR = 0.0006;
        const BAR_SPACING = 8.0;
        const SCENE_FLOOR_Y = 18; 
        const TARGET_VISUAL_HEIGHT = 60;

        const CameraView = {
          FREE: 'FREE',
          CINEMATIC: 'CINEMATIC',
          FRONT: 'FRONT'
        };

        // ==========================================
        // 2. 3D Âú∫ÊôØÁªÑ‰ª∂
        // ==========================================

        const Constellations = () => {
          const lineGeom = useMemo(() => {
            const points = [];
            const radius = 650;
            const count = 15; 
            for (let i = 0; i < count; i++) {
              const phi = Math.random() * Math.PI;
              const theta = Math.random() * Math.PI * 2;
              const center = new THREE.Vector3().setFromSphericalCoords(radius, phi, theta);
              let prev = center.clone();
              const segments = 2 + Math.floor(Math.random() * 3);
              for (let j = 0; j < segments; j++) {
                const next = prev.clone().add(new THREE.Vector3((Math.random()-0.5)*150, (Math.random()-0.5)*150, (Math.random()-0.5)*150)).normalize().multiplyScalar(radius);
                points.push(prev.clone(), next.clone());
                prev = next;
              }
            }
            return new THREE.BufferGeometry().setFromPoints(points);
          }, []);
          return React.createElement('lineSegments', { geometry: lineGeom },
            React.createElement('lineBasicMaterial', { 
              color: "#6366f1", 
              transparent: true, 
              opacity: 0.05, 
              blending: THREE.AdditiveBlending, 
              depthWrite: false 
            })
          );
        };

        const DeepSpaceGalaxy = () => {
          const groupRef = useRef(null);
          useFrame((state) => {
            if (groupRef.current) {
              groupRef.current.rotation.y = state.clock.elapsedTime * 0.01;
            }
          });
          return React.createElement('group', { ref: groupRef },
            React.createElement(Stars, { radius: 400, depth: 50, count: 6000, factor: 1.5, saturation: 0, fade: true, speed: 0.05 }),
            React.createElement(Sparkles, { count: 35, scale: 600, size: 45, speed: 0.1, opacity: 0.3, color: "#1e3a8a" }),
            React.createElement(Float, { speed: 2, rotationIntensity: 0.2, floatIntensity: 0.5 },
              React.createElement('group', { position: [150, 80, -500] },
                React.createElement('mesh', { scale: [180, 180, 180] },
                  React.createElement('sphereGeometry', { args: [1, 32, 32] }),
                  React.createElement('meshBasicMaterial', { color: "#4338ca", transparent: true, opacity: 0.15, blending: THREE.AdditiveBlending })
                ),
                React.createElement('pointLight', { intensity: 80, distance: 2000, color: "#818cf8" })
              )
            ),
            React.createElement(Sparkles, { count: 50, scale: [800, 50, 800], size: 3, speed: 0.3, opacity: 0.4, color: "#ffffff" }),
            React.createElement(Constellations)
          );
        };

        const AxisGrid = ({ data, steepness, show }) => {
          if (!show) return null;

          const maxValue = data[data.length - 1].value;
          
          let step = 1000;
          if (maxValue > 50000) step = 10000;
          else if (maxValue > 10000) step = 5000;
          else if (maxValue > 5000) step = 1000;
          else step = 500;

          const count = Math.ceil(maxValue / step);
          const totalWidth = (data.length - 1) * BAR_SPACING;
          
          const lines = [];
          for (let i = 1; i <= count; i++) {
             lines.push(i * step);
          }

          return React.createElement('group', { position: [0, 0, 0] },
            lines.map((val) => {
              const yPos = val * SCALE_FACTOR * steepness;
              return React.createElement('group', { key: val, position: [0, yPos, 0] },
                React.createElement(Line, { 
                  points: [[-totalWidth/2 - 5, 0, 0], [totalWidth/2 + 5, 0, 0]], 
                  color: "#6366f1", 
                  opacity: 0.15, 
                  transparent: true, 
                  dashed: true, 
                  dashScale: 2,
                  dashSize: 1,
                  gapSize: 1,
                  lineWidth: 1 
                }),
                React.createElement(Billboard, { position: [-totalWidth/2 - 8, 0, 0] },
                  React.createElement(Text, { 
                    fontSize: 1.2, 
                    color: "#818cf8", 
                    fillOpacity: 0.5, 
                    anchorX: "right", 
                    anchorY: "middle"
                  }, val.toLocaleString())
                )
              );
            })
          );
        };

        const BarNode = ({ item, index, total, progress, active, thickness, labelOffset, steepness }) => {
          const meshRef = useRef(null);
          const growth = Math.max(0, Math.min(1, progress - index));
          
          const labelOpacity = THREE.MathUtils.smoothstep(growth, 0, 0.2);
          const labelScale = THREE.MathUtils.lerp(0.6, 1, THREE.MathUtils.smoothstep(growth, 0, 0.3));
          
          const targetHeight = item.value * SCALE_FACTOR * steepness;
          const currentHeight = Math.max(0.1, targetHeight * growth);
          
          const totalWidth = (total - 1) * BAR_SPACING;
          const xPos = (index * BAR_SPACING) - (totalWidth / 2);

          useFrame((state) => {
            if (meshRef.current) {
              const material = meshRef.current.material;
              const pulse = active ? Math.sin(state.clock.elapsedTime * 6) * 0.2 + 0.3 : 0.05;
              material.emissiveIntensity = THREE.MathUtils.lerp(material.emissiveIntensity, pulse, 0.1);
            }
          });

          return React.createElement('group', { position: [xPos, 0, 0] },
            React.createElement('mesh', { 
              ref: meshRef,
              scale: [thickness, currentHeight, thickness], 
              position: [0, currentHeight / 2, 0],
              castShadow: true,
              receiveShadow: true
            },
              React.createElement('boxGeometry', { args: [3.5, 1, 3.5] }),
              React.createElement('meshStandardMaterial', { 
                color: item.color, 
                emissive: item.color, 
                emissiveIntensity: 0.05, 
                roughness: 0.1, 
                metalness: 0.8 
              })
            ),
            growth > 0.01 && React.createElement(Billboard, { position: [0, currentHeight + labelOffset, 0] },
              React.createElement(Float, { speed: 1.2, rotationIntensity: 0.1, floatIntensity: 0.15 },
                React.createElement('group', { scale: labelScale },
                  React.createElement(Text, { position: [0, 2.5, 0], fontSize: 1.6, fillOpacity: labelOpacity, anchorX: "center" }, item.flag),
                  React.createElement(Text, { position: [0, 1.2, 0], fontSize: 0.6, fontWeight: "bold", color: "#ffffff", fillOpacity: labelOpacity, anchorX: "center" }, item.name),
                  React.createElement(Text, { 
                    position: [0, 0, 0], 
                    fontSize: 1.4, 
                    fontWeight: "black", 
                    color: active ? "#ffffff" : item.color, 
                    fillOpacity: labelOpacity, 
                    anchorX: "center" 
                  }, (() => {
                    const val = item.value * (growth > 0.9 ? 1 : growth);
                    return Number.isInteger(val) ? Math.round(val).toLocaleString() : val.toFixed(0);
                  })())
                )
              )
            )
          );
        };

        const CameraController = ({ view, progress, data, isPlaying, camAngle, camDistance, autoRotate, steepness }) => {
          const { camera, size } = useThree();
          const controlsRef = useRef(null);
          const targetPos = useMemo(() => new THREE.Vector3(), []);
          const lookAtTarget = useMemo(() => new THREE.Vector3(), []);
          
          const total = data.length;
          const totalWidth = (total - 1) * BAR_SPACING;
          const maxHeight = data[total - 1].value * SCALE_FACTOR * steepness;

          useFrame((state) => {
            if (!controlsRef.current) return;
            const controls = controlsRef.current;
            
            const currentActiveIdx = Math.max(0, Math.min(total - 1, progress - 0.5));
            const floorIdx = Math.floor(currentActiveIdx);
            const ceilIdx = Math.min(total - 1, floorIdx + 1);
            const alpha = currentActiveIdx - floorIdx;
            
            const currentVal = data[floorIdx].value + (data[ceilIdx].value - data[floorIdx].value) * alpha;
            const heightAtFocus = currentVal * SCALE_FACTOR * steepness;
            const xPosAtFocus = (currentActiveIdx * BAR_SPACING) - (totalWidth / 2);

            if (view === CameraView.CINEMATIC) {
              const focusCenterY = SCENE_FLOOR_Y + (heightAtFocus * 0.5) + 3;
              const rad = ((camAngle + 30) * Math.PI) / 180;
              
              lookAtTarget.set(xPosAtFocus, focusCenterY, 0);
              controls.target.lerp(lookAtTarget, 0.08);

              if (isPlaying || progress < total) {
                const dynamicZoomOut = Math.max(0, (heightAtFocus - 20) * 0.9); 
                const activeDistance = camDistance + dynamicZoomOut;
                const dynamicHeightLift = Math.max(0, (heightAtFocus - 15) * 0.3);

                targetPos.set(
                  xPosAtFocus + Math.sin(rad) * activeDistance, 
                  focusCenterY + 4 + dynamicHeightLift,
                  Math.cos(rad) * activeDistance
                );
                
                camera.position.lerp(targetPos, 0.04);
              }
              controls.update();
            } 
            else if (view === CameraView.FRONT) {
              const fovRad = camera.fov * (Math.PI / 180);
              const aspect = size.width / size.height;
              
              const contentHeight = maxHeight * 1.1 + 10; 
              const contentWidth = totalWidth * 1.1 + 15;
              
              const distByWidth = (contentWidth / 2) / Math.tan(fovRad / 2) / aspect;
              const distByHeight = (contentHeight / 2) / Math.tan(fovRad / 2);
              
              const finalDist = Math.max(distByWidth, distByHeight, camDistance * 1.2);
              const targetY = SCENE_FLOOR_Y + (maxHeight * 0.45);

              const rotationSpeed = autoRotate ? state.clock.elapsedTime * 0.1 : 0;
              const rotAngle = (camAngle * Math.PI / 180) + rotationSpeed;

              lookAtTarget.set(0, targetY, 0);
              const camHeight = targetY + (maxHeight * 0.15) + 5;

              targetPos.set(Math.sin(rotAngle) * finalDist, camHeight, Math.cos(rotAngle) * finalDist);
              
              controls.target.lerp(lookAtTarget, 0.06);
              camera.position.lerp(targetPos, 0.06);
              controls.update();
            }
          });

          return React.createElement(OrbitControls, { 
            ref: controlsRef, 
            makeDefault: true, 
            enableDamping: true, 
            dampingFactor: 0.05, 
            minDistance: 5, 
            maxDistance: 2500, 
            maxPolarAngle: Math.PI / 2.02 
          });
        };

        const SceneContent = (props) => {
          const activeIndex = Math.floor(props.progress);

          return React.createElement(React.Fragment, null,
            React.createElement('color', { attach: "background", args: ['#000000'] }),
            React.createElement(Suspense, { fallback: null }, React.createElement(Environment, { preset: "night" })),
            React.createElement(DeepSpaceGalaxy),
            React.createElement('fog', { attach: "fog", args: ['#000000', 100, 2000] }),
            
            React.createElement('group', { position: [0, SCENE_FLOOR_Y, 0] },
              React.createElement(AxisGrid, { data: props.data, steepness: props.steepness, show: props.showAxisLines })
            ),

            React.createElement(PerspectiveCamera, { makeDefault: true, position: [0, 60, 200], fov: 30 }),
            React.createElement(CameraController, { ...props }),
            
            React.createElement('directionalLight', { position: [100, 100, 100], intensity: 1.5 }),
            React.createElement('spotLight', { position: [-50, 150, 50], intensity: 3, angle: 0.3, penumbra: 1, castShadow: true }),
            React.createElement('ambientLight', { intensity: 0.4 }),

            React.createElement('group', { position: [0, SCENE_FLOOR_Y, 0] },
              React.createElement(ContactShadows, { opacity: 0.7, scale: 400, blur: 2.5, far: 40, resolution: 1024, color: "#000", position: [0, -0.01, 0] }),
              
              props.data.map((item, idx) => 
                React.createElement(BarNode, { 
                  key: item.id, 
                  item: item, 
                  index: idx, 
                  total: props.data.length, 
                  progress: props.progress, 
                  active: activeIndex === idx, 
                  thickness: props.thickness,
                  labelOffset: props.labelOffset,
                  steepness: props.steepness 
                })
              )
            ),
            React.createElement(BakeShadows)
          );
        };

        // ==========================================
        // 3. UI ÊéßÂà∂Èù¢Êùø
        // ==========================================
        const ControlsUI = (props) => {
          const [showSettings, setShowSettings] = useState(false);
          const progressPercent = Math.min(100, Math.round((props.progress / props.maxProgress) * 100));
          const currentRank = props.totalItems - Math.min(props.totalItems - 1, props.currentIndex);

          return React.createElement('div', { 
            className: "absolute bottom-6 left-1/2 -translate-x-1/2 w-[95%] max-w-4xl flex flex-col items-center bg-zinc-950/80 backdrop-blur-3xl border border-white/5 shadow-[0_35px_60px_-15px_rgba(0,0,0,1)] rounded-[2.5rem] overflow-visible transition-all" 
          },
            React.createElement('div', { 
              className: "w-[calc(100%-4rem)] h-1 bg-white/5 relative group cursor-pointer overflow-hidden mt-5 rounded-full" 
            },
              React.createElement('div', { 
                className: "absolute left-0 top-0 h-full bg-indigo-500 z-10 shadow-[0_0_15px_rgba(99,102,241,0.8)]", 
                style: { width: `${(props.progress / props.maxProgress) * 100}%` } 
              }),
              React.createElement('input', { 
                type: "range", 
                min: "0", 
                max: props.maxProgress, 
                step: "0.0001", 
                value: props.progress, 
                onChange: (e) => { 
                  props.setProgress(parseFloat(e.target.value)); 
                  props.setIsPlaying(false); 
                }, 
                className: "absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20" 
              })
            ),

            React.createElement('div', { className: "w-full px-8 py-4 flex items-center justify-between gap-3" },
              React.createElement('div', { className: "flex items-center gap-3" },
                React.createElement('button', { 
                  onClick: () => { 
                    if (props.progress >= props.maxProgress - 0.05) props.onReset(); 
                    else props.setIsPlaying(!props.isPlaying); 
                  }, 
                  className: `w-10 h-10 rounded-full flex items-center justify-center transition-all transform hover:scale-110 active:scale-95 ${props.isPlaying ? 'bg-white text-black' : 'bg-indigo-600 text-white shadow-xl shadow-indigo-500/20'}` 
                },
                  props.isPlaying ? React.createElement(Pause, { size: 20, fill: "currentColor" }) : React.createElement(Play, { size: 20, fill: "currentColor", className: "ml-0.5" })
                ),
                React.createElement('button', { 
                  onClick: props.onReset, 
                  className: "w-8 h-8 flex items-center justify-center text-zinc-500 hover:text-white hover:bg-white/10 rounded-full transition-colors" 
                },
                  React.createElement(RotateCcw, { size: 16 })
                )
              ),

              React.createElement('div', { className: "flex items-center flex-grow justify-center gap-4" },
                React.createElement('div', { className: "hidden sm:flex items-center px-4 border-r border-white/10 group min-w-[180px]" },
                  React.createElement('div', { className: "flex flex-col" },
                    React.createElement('div', { className: "flex items-center gap-2" },
                      React.createElement('span', { className: "text-[9px] font-black text-indigo-400 bg-indigo-400/10 px-1.5 py-0.5 rounded uppercase tracking-tighter" }, `Rank ${currentRank}`),
                      React.createElement('span', { className: "text-sm font-black text-white italic truncate max-w-[110px]" }, props.currentItem?.name || 'End Sequence'),
                      props.currentItem && React.createElement('span', { className: "text-lg leading-none" }, props.currentItem.flag)
                    )
                  )
                ),

                React.createElement('div', { className: "flex bg-black/50 p-1.5 rounded-2xl border border-white/5" },
                  [
                    { id: CameraView.CINEMATIC, icon: React.createElement(Camera, { size: 13 }), label: 'ÂΩ±Èô¢' },
                    { id: CameraView.FRONT, icon: React.createElement(Monitor, { size: 13 }), label: 'ÂÖ®ÊôØ' },
                    { id: CameraView.FREE, icon: React.createElement(MousePointer2, { size: 13 }), label: 'Ëá™Áî±' }
                  ].map((v) => 
                    React.createElement('button', { 
                      key: v.id, 
                      onClick: () => props.setView(v.id), 
                      className: `flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black tracking-wide transition-all ${props.view === v.id ? 'bg-indigo-100 text-indigo-950 shadow-lg' : 'text-zinc-500 hover:text-zinc-200'}` 
                    },
                      v.icon,
                      React.createElement('span', null, v.label)
                    )
                  )
                )
              ),

              React.createElement('div', { className: "flex items-center gap-4 relative" },
                React.createElement('div', { className: "hidden md:flex flex-col items-end" },
                  React.createElement('span', { className: "text-[11px] font-black text-indigo-500 tabular-nums tracking-widest" }, `${progressPercent}%`)
                ),
                React.createElement('button', { 
                  onClick: () => setShowSettings(!showSettings), 
                  className: `w-9 h-9 rounded-full border border-white/10 flex items-center justify-center transition-all ${showSettings ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30' : 'text-zinc-500 hover:text-white hover:bg-white/5'}` 
                },
                  showSettings ? React.createElement(X, { size: 18 }) : React.createElement(Settings2, { size: 18 })
                ),

                showSettings && React.createElement('div', { 
                  className: "absolute bottom-[calc(100%+2rem)] right-0 w-80 bg-zinc-950/95 backdrop-blur-3xl border border-white/10 p-6 rounded-[2rem] shadow-[0_0_100px_rgba(0,0,0,1)] z-50 flex flex-col gap-5 animate-in fade-in zoom-in-95 slide-in-from-bottom-6 duration-300" 
                },
                  React.createElement('div', { className: "flex items-center gap-2 border-b border-white/5 pb-3" },
                    React.createElement(BarChart3, { size: 16, className: "text-indigo-500" }),
                    React.createElement('h3', { className: "text-[11px] font-black text-zinc-100 uppercase tracking-[0.2em]" }, "Á≥ªÁªüË∞É‰ºò")
                  ),
                  
                  React.createElement('div', { className: "space-y-3" },
                    React.createElement('div', { className: "flex justify-between text-[9px] font-black uppercase text-zinc-500" },
                      React.createElement('span', { className: "flex items-center gap-1" },
                        React.createElement(TrendingUp, { size: 11 }),
                        " ÂûÇÁõ¥Êãâ‰º∏ (Steepness)"
                      ),
                      React.createElement('span', { className: "text-indigo-400" }, `${props.steepness.toFixed(1)}x`)
                    ),
                    React.createElement('input', { 
                      type: "range", 
                      min: "1.0", 
                      max: "10.0", 
                      step: "0.5", 
                      value: props.steepness, 
                      onChange: (e) => props.setSteepness(parseFloat(e.target.value)), 
                      className: "w-full accent-indigo-500 h-1 bg-zinc-900 rounded-full appearance-none cursor-pointer" 
                    })
                  ),

                  React.createElement('div', { className: "space-y-3" },
                    React.createElement('div', { className: "flex justify-between text-[9px] font-black uppercase text-zinc-500" },
                      React.createElement('span', null, "Êí≠ÊîæÂÄçÈÄü"),
                      React.createElement('span', { className: "text-indigo-400" }, `${props.speed.toFixed(1)}x`)
                    ),
                    React.createElement('input', { 
                      type: "range", 
                      min: "0.1", 
                      max: "4.0", 
                      step: "0.1", 
                      value: props.speed, 
                      onChange: (e) => props.setSpeed(parseFloat(e.target.value)), 
                      className: "w-full accent-indigo-500 h-1 bg-zinc-900 rounded-full appearance-none cursor-pointer" 
                    })
                  ),

                  React.createElement('div', { className: "space-y-3" },
                    React.createElement('div', { className: "flex justify-between text-[9px] font-black uppercase text-zinc-500" },
                      React.createElement('span', { className: "flex items-center gap-1" },
                        React.createElement(MoveUp, { size: 11 }),
                        " Ê†áÁ≠æÈ´òÂ∫¶"
                      ),
                      React.createElement('span', { className: "text-indigo-400" }, `${props.labelOffset.toFixed(1)}m`)
                    ),
                    React.createElement('input', { 
                      type: "range", 
                      min: "0.5", 
                      max: "8.0", 
                      step: "0.1", 
                      value: props.labelOffset, 
                      onChange: (e) => props.setLabelOffset(parseFloat(e.target.value)), 
                      className: "w-full accent-indigo-500 h-1 bg-zinc-900 rounded-full appearance-none cursor-pointer" 
                    })
                  ),

                  React.createElement('div', { className: "grid grid-cols-2 gap-3 pt-3" },
                    React.createElement('button', { 
                      onClick: () => props.setShowAxisLines(!props.showAxisLines),
                      className: `py-3 rounded-xl text-[9px] font-black uppercase transition-all ${props.showAxisLines ? 'bg-indigo-600/20 text-indigo-400 border border-indigo-500/30 shadow-inner' : 'bg-white/5 text-zinc-500'}` 
                    }, "ÂèÇËÄÉÊ†áÁ∫ø"),
                    React.createElement('button', { 
                      onClick: () => props.setAutoRotate(!props.autoRotate),
                      className: `py-3 rounded-xl text-[9px] font-black uppercase transition-all ${props.autoRotate ? 'bg-indigo-600/20 text-indigo-400 border border-indigo-500/30 shadow-inner' : 'bg-white/5 text-zinc-500'}` 
                    }, "Ëá™Âä®Ëà™Ë°å")
                  )
                )
              )
            )
          );
        };

        // ==========================================
        // 4. ‰∏ªÁ®ãÂ∫èÂÖ•Âè£
        // ==========================================
        const App = () => {
          const sortedData = useMemo(() => [...CONFIG.data].sort((a, b) => a.value - b.value), []);

          const calculateAutoSteepness = () => {
              if (sortedData.length === 0) return 3.0;
              const maxVal = Math.max(...sortedData.map(d => d.value));
              const autoVal = TARGET_VISUAL_HEIGHT / (maxVal * SCALE_FACTOR);
              return Math.max(1.0, Math.min(10.0, autoVal));
          };

          const [progress, setProgress] = useState(0);
          const [isPlaying, setIsPlaying] = useState(true);
          const [view, setView] = useState(CameraView.CINEMATIC);
          
          const [playbackSpeed, setPlaybackSpeed] = useState(1.0); 
          const [camAngle, setCamAngle] = useState(0); 
          const [camDistance, setCamDistance] = useState(48); 
          const [thickness, setThickness] = useState(1.0);
          const [labelOffset, setLabelOffset] = useState(2.2); 
          const [autoRotate, setAutoRotate] = useState(true); 
          
          const [steepness, setSteepness] = useState(calculateAutoSteepness());
          const [showAxisLines, setShowAxisLines] = useState(true);

          const totalItems = sortedData.length;
          const maxProgress = totalItems;
          const currentIndex = Math.floor(progress);
          const currentItem = sortedData[Math.min(totalItems - 1, currentIndex)];

          const handleReset = () => { 
            setProgress(0); 
            setIsPlaying(true); 
            setView(CameraView.CINEMATIC); 
            setAutoRotate(true);
            setSteepness(calculateAutoSteepness());
          };

          useEffect(() => {
            if (!isPlaying) return;
            let frameId;
            const animate = () => {
              setProgress((prev) => {
                const next = prev + (0.005 * playbackSpeed);
                if (next >= maxProgress) { 
                  setIsPlaying(false); 
                  setTimeout(() => {
                     setView(v => v === CameraView.CINEMATIC ? CameraView.FRONT : v);
                     setAutoRotate(true);
                  }, 300);
                  return maxProgress; 
                }
                return next;
              });
              frameId = requestAnimationFrame(animate);
            };
            frameId = requestAnimationFrame(animate);
            return () => cancelAnimationFrame(frameId);
          }, [isPlaying, maxProgress, playbackSpeed]);

          return React.createElement('div', { 
            className: "flex flex-col w-full h-[100dvh] bg-black text-white font-sans select-none overflow-hidden relative" 
          },
            React.createElement('div', { className: "absolute inset-0 z-0" },
              React.createElement(Canvas, { 
                shadows: true, 
                gl: { antialias: true, toneMapping: THREE.ACESFilmicToneMapping },
                camera: { fov: 30, near: 0.1, far: 3000 }
              },
                React.createElement(PerformanceMonitor),
                React.createElement(AdaptiveDpr),
                React.createElement(AdaptiveEvents),
                React.createElement(SceneContent, { 
                  data: sortedData, 
                  progress: progress, 
                  view: view, 
                  isPlaying: isPlaying, 
                  speed: playbackSpeed,
                  camAngle: camAngle, 
                  camDistance: camDistance,
                  thickness: thickness,
                  labelOffset: labelOffset,
                  autoRotate: autoRotate,
                  steepness: steepness,
                  showAxisLines: showAxisLines
                })
              )
            ),

            React.createElement('div', { className: "relative top-0 left-0 p-10 md:p-14 z-10 pointer-events-none w-full flex flex-col gap-2" },
              React.createElement('div', { className: "flex items-center gap-3" },
                React.createElement('div', { className: "w-2.5 h-2.5 rounded-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,1)] animate-pulse" }),
                React.createElement('span', { className: "text-[11px] font-black tracking-[0.8em] uppercase text-indigo-400/80" }, CONFIG.ui.meta)
              ),
              React.createElement('h1', { className: "text-5xl md:text-7xl font-black tracking-tighter leading-none text-white drop-shadow-[0_15px_15px_rgba(0,0,0,0.9)]" },
                CONFIG.ui.title,
                CONFIG.ui.unit && React.createElement('span', { className: "text-2xl md:text-3xl ml-4 opacity-70" }, `(${CONFIG.ui.unit})`)
              ),
              React.createElement('p', { className: "text-zinc-500 text-xs md:text-sm font-bold tracking-[0.3em] opacity-60 uppercase" }, CONFIG.ui.subTitle)
            ),

            React.createElement('div', { className: "z-30 pointer-events-auto" },
              React.createElement(ControlsUI, { 
                isPlaying: isPlaying, 
                setIsPlaying: setIsPlaying, 
                progress: progress, 
                setProgress: setProgress, 
                maxProgress: maxProgress, 
                view: view, 
                setView: setView, 
                speed: playbackSpeed, 
                setSpeed: setPlaybackSpeed, 
                angle: camAngle, 
                setAngle: setCamAngle, 
                distance: camDistance, 
                setDistance: setCamDistance, 
                thickness: thickness, 
                setThickness: setThickness,
                labelOffset: labelOffset, 
                setLabelOffset: setLabelOffset,
                autoRotate: autoRotate, 
                setAutoRotate: setAutoRotate,
                steepness: steepness, 
                setSteepness: setSteepness,
                showAxisLines: showAxisLines, 
                setShowAxisLines: setShowAxisLines,
                onReset: handleReset,
                currentItem: currentItem,
                currentIndex: currentIndex,
                totalItems: totalItems
              })
            ),

            React.createElement('div', { className: "absolute top-1/2 left-10 -translate-y-1/2 flex flex-col gap-10 opacity-10 pointer-events-none hidden lg:flex" },
              React.createElement('div', { className: "flex flex-col gap-2" },
                React.createElement('div', { className: "w-16 h-0.5 bg-indigo-500" }),
                React.createElement('span', { className: "text-[9px] font-bold tracking-widest uppercase" }, CONFIG.ui.axisX)
              ),
              React.createElement('div', { className: "flex flex-col gap-2" },
                React.createElement('div', { className: "w-16 h-0.5 bg-zinc-100" }),
                React.createElement('span', { className: "text-[9px] font-bold tracking-widest uppercase" }, CONFIG.ui.axisY)
              )
            )
          );
        };

        const rootElement = document.getElementById('root');
        if (rootElement) {
          ReactDOM.createRoot(rootElement).render(React.createElement(App));
        }
    </script>
</body>
</html>
